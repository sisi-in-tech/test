ALTER PROCEDURE [dbo].[P_REFRESH_VIEWS_HMDA_SISI]
AS
BEGIN

DECLARE @SQLSTRING VARCHAR(MAX), 
	    @TBL VARCHAR(500)

DECLARE C1 CURSOR FOR 
SELECT NAME 
FROM HMDA.SYS.TABLES
ORDER BY NAME

OPEN C1
FETCH C1 INTO @TBL
WHILE @@FETCH_STATUS = 0
BEGIN
 SELECT @SQLSTRING = 
 ' IF EXISTS (SELECT * FROM SYS.VIEWS WHERE NAME = ''' + @TBL + ''') ' + 
 ' BEGIN ' + 
 '  DROP VIEW ' + @TBL + 
 ' END ' 
 
 EXEC (@SQLSTRING)

 SELECT @SQLSTRING = ' CREATE VIEW ' + @TBL + ' AS SELECT * FROM HMDA..' + @TBL
 
 EXEC (@SQLSTRING)

 FETCH C1 INTO @TBL
END
CLOSE C1
DEALLOCATE C1




END