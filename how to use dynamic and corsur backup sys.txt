ALTER PROCEDURE [dbo].[P_DBA_BACKUP]
AS
BEGIN

--USE A CURSOR
/***********
DECLARE @SALES_PERSON_ID INT,
	    @SALES_PERSON_NAME VARCHAR(1000)

DECLARE C_1 CURSOR FOR
SELECT SALES_PERSON_ID, SALES_PERSON_NAME
FROM SALES_PERSON
ORDER BY SALES_PERSON_NAME

OPEN C_1
--DECLARE @SALES_PERSON_ID INT, @SALES_PERSON_NAME VARCHAR(1000)
FETCH C_1 INTO @SALES_PERSON_ID, @SALES_PERSON_NAME
WHILE @@FETCH_STATUS = 0
BEGIN
  SELECT @SALES_PERSON_ID, @SALES_PERSON_NAME
  FETCH C_1 INTO @SALES_PERSON_ID, @SALES_PERSON_NAME
END
CLOSE C_1
DEALLOCATE C_1
************/

-- USE DYNAMIC SQL
/************
SELECT * FROM SALES_PERSON
EXEC ('SELECT * FROM Sales_Person')
DECLARE @SQL_TEXT VARCHAR(MAX)
SELECT @SQL_TEXT = 'SELECT * FROM SALES_PERSON'
EXEC (@SQL_TEXT)
EXEC sp_executesql N'SELECT * FROM SALES_PERSON';

DECLARE @SQL_TEXT NVARCHAR(MAX)
SELECT @SQL_TEXT = 'SELECT * FROM SALES_PERSON'
EXEC sp_executesql @SQL_TEXT


DECLARE @SQL_TEXT NVARCHAR(MAX)
SELECT @SQL_TEXT = 'SELECT * FROM SALES_PERSON WHERE SALES_PERSON_ID = 3'
EXEC sp_executesql @SQL_TEXT

DECLARE @SQL_TEXT NVARCHAR(MAX), 
        @SALES_PERSON_ID INT = 3
SELECT @SQL_TEXT = 'SELECT * FROM SALES_PERSON WHERE SALES_PERSON_ID = ' + 
   CONVERT(NVARCHAR(100), @SALES_PERSON_ID)
SELECT SQL_TEXT = @SQL_TEXT
EXEC sp_executesql @SQL_TEXT
***/
DECLARE @DB_NAME NVARCHAR(1000),
		@SQL_STRING NVARCHAR(MAX)

DECLARE C_DB CURSOR FOR
SELECT NAME 
FROM SYS.databases
WHERE NAME <> 'TEMPDB'
ORDER BY NAME

OPEN C_DB
FETCH C_DB INTO @DB_NAME 
WHILE @@FETCH_STATUS = 0
BEGIN
--DECLARE @SQL_STRING NVARCHAR(MAX)
 SELECT @SQL_STRING = 
 ' BACKUP DATABASE ' + @DB_NAME + 
 ' TO DISK = ''C:\Program Files\Microsoft SQL Server\MSSQL15.SQLSERVER2019\MSSQL\DATA\' + 
       @DB_NAME + '.BAK'' ' + 
' WITH INIT, STATS = 1 ' 

 SELECT SQL_STRING = @SQL_STRING
 EXEC sp_executesql @SQL_STRING

 FETCH C_DB INTO @DB_NAME 
END 
CLOSE C_DB
DEALLOCATE C_DB

/**********

---BACK UP ONLY ONE DATA
BACKUP DATABASE cpidata 
TO DISK = 'C:\Program Files\Microsoft SQL Server\MSSQL15.SQLSERVER2019\MSSQL\DATA\cpidata.BAK'
WITH INIT, STATS = 1


BACKUP DATABASE NORDSTROM_SALES_DEVELOPMENT 
TO DISK = 'C:\Program Files\Microsoft SQL Server\MSSQL15.SQLSERVER2019\MSSQL\DATA\NORDSTROM_SALES_DEVELOPMENT.BAK'
WITH INIT, STATS = 1
********/
/*
RESTORE FILELISTONLY
FROM DISK = 'C:\Program Files\Microsoft SQL Server\MSSQL15.SQLSERVER2019\MSSQL\DATA\NORDSTROM_SALES.BAK'

RESTORE DATABASE NORDSTROM_SALES_2
--RESTORE FILELISTONLY
FROM DISK = 'C:\Program Files\Microsoft SQL Server\MSSQL15.SQLSERVER2019\MSSQL\DATA\NORDSTROM_SALES.BAK'
WITH MOVE 'NORDSTROM_SALES' TO 'C:\Program Files\Microsoft SQL Server\MSSQL15.SQLSERVER2019\MSSQL\DATA\NORDSTROM_SALES_2.mdf',
    MOVE 'NORDSTROM_SALES_log' TO 'C:\Program Files\Microsoft SQL Server\MSSQL15.SQLSERVER2019\MSSQL\DATA\NORDSTROM_SALES_2_log.ldf'
*/
--select 1

END